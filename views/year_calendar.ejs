<%- include('partials/header', { title: `Calendário ${category} ${year}` }) %>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Calendário Anual de Férias - <%= category %> - <%= year %></h3>
    <div>
        <button class="btn btn-primary" id="download-calendar-pdf"><i class="bi bi-file-earmark-pdf"></i> Download PDF</button>
        <a href="/vacations/calendar-options" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Voltar</a>
    </div>
</div>

<div id="calendar-container-to-print">
<% const monthNames = ['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro']; %>
<div class="row">
    <% for (let month = 1; month <= 12; month++) { %>
    <div class="col-12 col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white text-center">
                <strong><%= monthNames[month - 1] %></strong>
            </div>
            <div class="table-responsive">
                <table class="table table-bordered text-center calendar-table small">
                    <thead><tr class="table-light"><th>Dom</th><th>Seg</th><th>Ter</th><th>Qua</th><th>Qui</th><th>Sex</th><th>Sáb</th></tr></thead>
                    <tbody>
                        <%
                            const daysInMonth = new Date(Date.UTC(year, month, 0)).getUTCDate();
                            const firstDayOfWeek = new Date(Date.UTC(year, month - 1, 1)).getUTCDay();
                            let dayCounter = 1;
                            for (let i = 0; i < 6; i++) {
                        %>
                            <tr>
                                <% for (let j = 0; j < 7; j++) { %>
                                    <% if ((i === 0 && j < firstDayOfWeek) || dayCounter > daysInMonth) { %>
                                        <td class="bg-light"></td>
                                    <% } else { %>
                                        <td>
                                            <div><strong><%= dayCounter %></strong></div>
                                            <% 
                                                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(dayCounter).padStart(2, '0')}`;
                                                const names = calendarData[dateStr] || [];
                                                if (names.length > 0) {
                                            %>
                                                <ul class="list-unstyled mb-0">
                                                    <% names.forEach(name => { %>
                                                        <li class="badge bg-success-subtle text-success-emphasis rounded-pill"><%= name.split(' ')[0] %></li>
                                                    <% }); %>
                                                </ul>
                                            <% } %>
                                        </td>
                                    <% dayCounter++; } %>
                                <% } %>
                            </tr>
                        <% if (dayCounter > daysInMonth) break; } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <% } %>
</div>
</div>

<script>
    var EJS_DATA = JSON.parse('<%- JSON.stringify({ calendarData, year, category }) %>');
</script>

<%- include('partials/footer') %>